<div class="byk-field" class:byk-has-label={!!label} class:byk-field--invalid={$validity.dirty && !$validity.valid}>
  {#if label}
    <label for={fieldId} class="label">{label}</label>
  {/if}
  <div class="time-input" use:validate={value}>
    <div class="selectors">
      <select id={fieldId} bind:value={hour} aria-label={ariaLabel} on:blur on:change={updateValue}>
        <option value={null}>--</option>
        {#each hours as hh (hh)}
        <option value={hh}>{hh}</option>
        {/each}
      </select>
      <span>:</span>
      <select bind:value={minute} aria-label={ariaLabel} on:blur on:change={updateValue}>
        <option value={null}>--</option>
        {#each minutes as mm (mm)}
        <option value={mm}>{mm}</option>
        {/each}
      </select>
    </div>
    <span class="field-icon icon is-medium is-right" class:is-danger={!$validity.valid} class:is-success={$validity.valid}>
      {#if $validity.dirty}
        {#if $validity.valid}
          <CheckIcon />
        {:else}
          <XIcon />
        {/if}
      {/if}
    </span>
  </div>
  {#if validationHints && $validity.dirty && !$validity.valid}
    <p class="help is-danger">{$validity.message}</p>
  {/if}
</div>

<script>
  import { createEventDispatcher } from 'svelte'
  import { CheckIcon, XIcon } from 'svelte-feather-icons'

  const dispatch = createEventDispatcher()

export let value = null
  export let label = false
  export let validate
  export let validity
  export let ariaLabel = label
  export let validationHints = true
  export let increment = 15

  const fieldId = `byk_id_${Math.random().toString(36).substring(0, 8)}`

  const hours = new Array(24).fill(0).map((h, i) => i.toString().padStart(2, '0'))
  const minutes = Array.from({ length: 60 / increment }, Number.call, i => String(i * increment).padStart(2, '0'))
  
  let hour = value ? value.split(':')[0] : null
  let minute = value ? value.split(':')[1] : null

  function updateValue () {
    if (hour && minute) {
      value = `${hour || '--'}:${minute || '--'}`
      dispatch('change', { value })
    }
  }

  $: if (!value) {
    hour = null
    minute = null
  }
</script>

<style>
  .byk-field {
    margin: 6px 0;
  }

  .byk-field.byk-has-label {
    margin: 0;
  }

	.time-input {
    display: inline-flex;
		align-items: center;
		border: 1px solid var(--byk-c-control-border);
    margin-bottom: 3px;
	}

  .byk-field.byk-field--invalid .time-input {
		border: 1px solid var(--byk-c-danger);
  }

  .time-input .selectors {
    display: flex;
    align-items: flex-start;
    padding: 5px 0 4px 0;
  }
	
	span {
		margin: 0 6px;
		font-weight: bold;
	}
	
	select {
		border: 0;
		margin: 0;
		background-color: var(--byk-c-input-background);
    font-size: 1rem;
		-webkit-appearance: none;
		-moz-appearance: none;
    padding: 3px;
	}
</style>
